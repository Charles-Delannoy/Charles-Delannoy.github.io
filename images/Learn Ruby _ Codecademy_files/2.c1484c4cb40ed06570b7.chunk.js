(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[2],{"+uL7":function(e,t,s){"use strict";var n=s("hhPA"),i=s.n(n);t.a=i.a.createActions(["apologize"])},"4TZy":function(e,t,s){"use strict";var n=s("hhPA"),i=s.n(n),r=s("BzM2"),a=s("wd/R"),o=s.n(a),c=s("Td3C"),u=s("+uL7"),l=s("cITI"),h=s("sEoa"),p=s("T2dD"),f=s("Psin"),d=s("H6Yg"),S=s("vH5F"),g=s("24Ii"),v=s.n(g),k=s("YZR6");var w=s("OAZI"),y=s("YDNT"),m=s("USHi");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{},n=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(s).filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,s[t])})}return e}function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,"b",function(){return b});var b={NEUTRAL:"neutral",SUCCESS:"success",ERROR:"error",IDLE:"idle"};m.a.on("active",function(){c.a.ping()});var F={name:"WorkspaceStore",mixins:[r.StateMixin.store],init:function init(){this.connectionIdentifier=0,this.listenToMany({initialize:c.a.initialize,persist:c.a.persist,setWorkspace:c.a.setWorkspace,setStatus:c.a.setStatus,setReadyState:c.a.setReadyState,setIdleState:c.a.setIdleState,setOfflineState:c.a.setOfflineState,updateFiles:c.a.updateFiles,createDirectories:c.a.createDirectories,deleteFile:c.a.deleteFile,rename:c.a.rename,getFileTree:c.a.getFileTree,getFile:c.a.getFile,getFiles:c.a.getFiles,restore:c.a.restore,solution:c.a.solution,reset:c.a.reset,ping:c.a.ping,createInitialSavepoint:c.a.createInitialSavepoint,getFetchUrl:c.a.getFetchUrl,createFinalSavepoint:c.a.createFinalSavepoint,deleteWorkspace:c.a.deleteWorkspace})},getInitialState:function getInitialState(){return{clientOffline:!1,workspaceDirty:!1,workspaceReady:!1,workspaceIdle:!1,workspaceUnpersistedChanges:!1,workspaceClientHasLostConnection:!1,workspaceSlug:null,workspaceOwner:null,workspaceObject:null,workspaceDirectory:{},workspaceStatusType:null,workspaceStatusMessage:null,lastPersisted:null}},getDefaultWorkspaceState:function getDefaultWorkspaceState(){return{workspaceObject:this.interface.workspace,workspaceDirectory:_objectSpread({},this.interface.workspace.root)}},status:function status(e){var t=b.NEUTRAL,s=b.SUCCESS,n=b.ERROR,i=b.IDLE;return{OFFLINE:{message:this.state.lastPersisted?"Your internet connection is offline. Code was last saved at ".concat(o()(this.state.lastPersisted).format("LT"),"."):"You are offline. Please connect to the internet and try again.",type:n},CONNECTING:{message:"Connecting to Codecademy",type:t},AVAILABLE:{message:"Connected to Codecademy",type:s},UNAVAILABLE:{message:"Unable to connect to Codecademy",type:n},DISCONNECTED:{message:"Lost connection to Codecademy",type:n},IDLE:{message:"Session timed out",type:i},EVAL_ERROR:{message:"Sorry, there is an error in this content. Please try again later.",type:n}}[e]},broadcast:function broadcast(e,t){this.interface.broadcast(e,t)},setWorkspace:function setWorkspace(e){var t=this,s=c.a.setWorkspace,n=s.completed,i=s.failed,r=new Date;if(this.state.workspaceObject&&e.slug===this.state.workspaceSlug){if(!this.interface.workspace)return;return this.setState({workspaceReady:!0}),this.trigger(this.state),void n(this.interface.workspace)}this.connectionIdentifier+=1;var a=this.connectionIdentifier;this.interface&&(this.interface.destroy(),delete this.interface),this.interface=new h.a(e),this.setState({workspaceReady:!1,workspaceObject:null,workspaceDirectory:[],workspaceClientHasLostConnection:!1,workspaceSlug:e.slug,workspaceOwner:e.user_id,workspaceType:e.einConfig.container_type,workspaceStatus:this.status("CONNECTING")}),this.initialize(a).then(function(s){if(t.connectionIdentifier===a){var i=new Date-r;l.a.onWorkspaceChanged(),n(t.interface.workspace),f.a.timing("container_api.connect_workspace",d.a.get("container_api_base").replace(/(\w+)\..*/,"$1"),i),Object(S.a)("info","connected to backend duration=".concat(i," connection_attempts=").concat(s.connectionAttempts)),t.redux.dispatch(Object(p.j)({workspace_type:e.einConfig.container_type,workspace_slug:e.slug,duration:i,backend:"container_api",connection_attempts:s.connectionAttempts}))}}).catch(function(s){if(t.connectionIdentifier===a){w.a.error(s),u.a.apologize(),c.a.setStatus("Unable to connect to Codecademy",b.ERROR),f.a.increment("WorkspaceStore.setWorkspace.".concat(e.backend),"failed");var n=d.a.get("container_api_base").replace(/(\w+)\..*/,"$1");f.a.increment("container_api.connect_workspace.".concat(n),"failed"),i(s)}})},setStatus:function setStatus(e,t){"object"===_typeof(e)?this._setStatus(e):this._setStatus({message:e,type:t})},ping:function ping(){this.interface&&this.interface.ping()},_setStatus:function _setStatus(e){if(void 0===e.message||void 0===e.type)throw new Error('Bad WorkspaceStore status request; should be an object with a "message" and a "type"');this.setState({workspaceStatusMessage:e.message,workspaceStatusType:e.type})},setReadyState:function setReadyState(e){this.setState({workspaceReady:e})},setIdleState:function setIdleState(e){this.setState({workspaceIdle:e})},setOfflineState:function setOfflineState(e){this.setState({clientOffline:e}),e&&(c.a.setIdleState(!0),c.a.setReadyState(!1),c.a.setStatus(C.status("OFFLINE")))},initialize:function initialize(e){var t=this,s=c.a.initialize,n=s.completed,i=s.failed;return this.interface.initialize().then(function(s){if(t.connectionIdentifier!==e)throw new Error("Will not update state for outated connection");return t.setState(_objectSpread({workspaceReady:!0,workspaceIdle:!1},t.getDefaultWorkspaceState())),n(),s}).catch(function(s){if(t.connectionIdentifier!==e)throw new Error("Will not set error state on outdated connection");w.a.error({message:"initialize promise rejected; ".concat(s.toString())}),i()})},persist:function persist(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=c.a.persist,n=s.completed,i=s.failed;Object(S.a)("info","Persisting workspace '".concat(this.state.workspaceObject.slug,"'")),this._attemptToPersist(e,t).then(n).catch(i)},_attemptToPersist:function _attemptToPersist(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise(function(n,i){e.interface.persist(t,s).then(function(){e._persistAttempts=0,Object(S.a)("info","Successfully persisted workspace '".concat(e.state.workspaceObject.slug,"'")),e.setState({workspaceDirty:!1,lastPersisted:new Date}),n()}).catch(function(t){e._persistAttempts+=1,w.a.error("Error while persisting workspace ".concat(e.state.workspaceObject.slug,": ").concat(t)),e._persistAttempts<3?e._attemptToPersist(n,i):(Object(S.a)("info","Giving up trying to persist workspace"),i(t))})})},getFileTree:function getFileTree(){var e=this,t=c.a.getFileTree,s=t.completed,n=t.failed;this.interface&&this.interface.getFileTree().then(function(t){e.setState(e.getDefaultWorkspaceState()),s(t)}).catch(n)},getFiles:function getFiles(e){var t=this,s=c.a.getFiles,n=s.completed,i=s.failed;this.interface.getFiles(e).then(function(e){t.trigger(t.state),n(e.filter(function(e){return Boolean(e)}))}).catch(i)},getFile:function getFile(e,t){var s=this,n=c.a.getFile,i=n.completed,r=n.failed;this.interface.getFile(e,t).then(function(e){i(e),s.trigger(s.state)}).catch(r)},deleteFile:function deleteFile(e){var t=this,s=c.a.deleteFile,n=s.completed,i=s.failed;this.interface.deleteFile(e).then(function(){t.setState(_objectSpread({workspaceDirty:!0},t.getDefaultWorkspaceState())),n()}).catch(i)},updateFiles:function updateFiles(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=c.a.updateFiles,i=n.completed,r=n.failed,a=s.overwriteExisting,o=void 0===a||a,u=[];if(!o){var l=!0,h=!1,p=void 0;try{for(var f,d=t[Symbol.iterator]();!(l=(f=d.next()).done);l=!0){var S=f.value;this.interface.workspace.exists(S.path)&&u.push("The file: ".concat(S.path," already exists"))}}catch(e){h=!0,p=e}finally{try{l||null==d.return||d.return()}finally{if(h)throw p}}}return u.length?r(u.join("\n")):(this.setState({workspaceUnpersistedChanges:!0}),this.interface.updateFiles(t).then(function(){e.setState(_objectSpread({workspaceDirty:!0,workspaceUnpersistedChanges:!1},e.getDefaultWorkspaceState())),i()}).catch(function(t){e.setState({workspaceDirty:!0}),r(t)}))},createDirectories:function createDirectories(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=c.a.createDirectories,i=n.completed,r=n.failed,a=s.overwriteExisting,o=void 0===a||a,u=[];if(!o){var l=!0,h=!1,p=void 0;try{for(var f,d=e[Symbol.iterator]();!(l=(f=d.next()).done);l=!0){var S=f.value;this.interface.workspace.exists(S.path)&&u.push("The directory: ".concat(S.path," already exists"))}}catch(e){h=!0,p=e}finally{try{l||null==d.return||d.return()}finally{if(h)throw p}}}u.length?r(u.join("\n")):this.interface.createDirectories(e).then(function(){t.setState(_objectSpread({workspaceDirty:!0},t.getDefaultWorkspaceState()))}).then(i)},rename:function rename(e,t){var s=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=c.a.rename,r=i.completed,a=i.failed,o=n.overwriteExisting,u=void 0===o||o;u||!this.interface.workspace.exists(t)?this.interface.rename(e,t).catch(a).then(function(e){return s.interface.getFileTree().then(function(){return s.setState(_objectSpread({workspaceDirty:!0},s.getDefaultWorkspaceState())),e})}).then(r):a("An item with that name already exists")},setController:function setController(e){this.controller=e},createInitialSavepoint:function createInitialSavepoint(){var e=c.a.createInitialSavepoint,t=e.completed,s=e.failed;return this.savePointHandler({checkpointSlug:this.controller.initialSavepointSlug(),workspaceSlug:this.state.workspaceSlug,completed:t,failed:s})},createFinalSavepoint:function createFinalSavepoint(){var e=c.a.createFinalSavepoint,t=e.completed,s=e.failed;this.savePointHandler({checkpointSlug:this.controller.finalSavepointSlug(),workspaceSlug:this.state.workspaceSlug,completed:t,failed:s})},getFetchUrl:function getFetchUrl(e){var t=this;this.setStatus("Saving workspace ".concat(e),b.NEUTRAL);var s=c.a.getFetchUrl,n=s.completed,i=s.failed;(function createSavepoint_getFetchUrl(e){var t=e.workspaceSlug;return v.a.post("/api/management/v1/workspaces/get_signed_url").use(k.a).send({workspace_slug:t})})({workspaceSlug:e}).end(function(s){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.body;return s?(t.setStatus("Error saving ".concat(e),b.ERROR),i()):(t.setStatus("Successfully saved ".concat(e),b.SUCCESS),n(a))})},savePointHandler:function savePointHandler(e){var t=this,s=e.checkpointSlug,n=e.workspaceSlug,i=e.completed,r=e.failed;return this.setStatus("Creating savepoint.",b.NEUTRAL),function createSavepoint(e){var t=e.checkpointSlug,s=e.workspaceSlug,n=e.userId;return v.a.post("/api/management/v1/workspaces/user/".concat(n,"/checkpoint")).use(k.a).send({checkpoint_slug:t,workspace_slug:s})}({checkpointSlug:s,workspaceSlug:n,userId:y.a.id()}).then(function(){t.setStatus("Successfully created savepoint.",b.SUCCESS),i()}).catch(function(e){t.setStatus("Failed to create savepoint.",b.ERROR),r(e),w.a.error({message:"Savepoint create failed for ".concat(s,", attempted to save workspace - ").concat(n)})})},restore:function restore(){return this._restore(c.a.restore,this.controller.initialSavepointSlug(),this.controller.getWorkspaceSetupCommand())},solution:function solution(){return this._restore(c.a.solution,this.controller.finalSavepointSlug(),this.controller.getWorkspaceSetupCommand())},reset:function reset(){return this._restore(c.a.reset,"",this.controller.getWorkspaceSetupCommand())},_restore:function _restore(e,t,s){var n=this,i=e.completed,r=e.failed;return this.setStatus("Restoring workspace.",b.NEUTRAL),l.a.stopAllSessions().then(function(){return n.interface.restore(t)}).then(function(){return n.execute(s)}).then(function(){n.setStatus("Workspace restored.",b.SUCCESS),i()}).catch(function(e){n.setStatus("Could not restore workspace.",b.ERROR),w.a.error({message:"Workspace restore failed for ".concat(n.controller.initialSavepointSlug(),", attempted to restore workspace - ").concat(n.state.workspaceSlug)}),r(e)})},spawn:function spawn(e,t){return this.interface.spawn(e,t)},execute:function execute(e){if(e)return this.interface.execute(e)},isOwner:function isOwner(){return this.state.workspaceOwner===y.a.id()},setReduxReference:function setReduxReference(e){var t=e.dispatch;this.redux={dispatch:t}}},C=i.a.createStore(F);t.a=C},FdhO:function(e,t,s){"use strict";for(var n=s("hhPA"),i=s.n(n),r=i.a.createActions([]),a=["clear","stdout","stderr","stdin","input"],o=0;o<a.length;o++){r[a[o]]=i.a.createAction()}t.a=r},cITI:function(e,t,s){"use strict";var n=s("mNz5"),i=s.n(n),r=s("hhPA"),a=s.n(r),o=s("BzM2"),c=s("nD6a"),u=s("4TZy"),l=s("Td3C");function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,s=new Array(e.length);t<e.length;t++)s[t]=e[t];return s}}(e)||function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h={name:"TerminalStore",mixins:[o.StateMixin.store],init:function init(){this.listenToMany(c.a),this.listenTo(l.a.restore.completed,this.onCloseAllSessions.bind(this))},getInitialState:function getInitialState(){return{busy:!1,sessions:[],hasFocus:!1,currentSession:null,hasCreatedSessionBefore:!1,fontSize:null}},_resetState:function _resetState(e){this.setState({sessions:[],currentSession:null,hasFocus:!1},function(){e&&e()})},_connectToSession:function _connectToSession(e){if(!this.state.busy&&3!==this.state.sessions.length){var t=i()("pty"),s={id:t,title:e,writes:[],term:null};this.setState({busy:!0});for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];u.a.spawn(e,r).then(this.acceptSession(s)).catch(c.a.createSession.failed)}},onWorkspaceChanged:function onWorkspaceChanged(){var e=this;this.state.sessions.length>0&&this._resetState(function(){e._connectToSession("bash")})},onCreateSession:function onCreateSession(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bash",t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];this._connectToSession.apply(this,[e].concat(s))},acceptSession:function acceptSession(e){var t=this;return function(s){e.stream=s,s.on("data",function(t){e.writes.push(t)});var n=_toConsumableArray(t.state.sessions);n.push(e),t.setState({sessions:n}),c.a.selectSession(t.state.sessions.length-1),c.a.createSession.completed(e),t.setState({busy:!1,hasCreatedSessionBefore:!0}),t.trigger(t.state)}},onFocus:function onFocus(){this.state.blurTimeout&&clearTimeout(this.state.blurTimeout),this.setState({hasFocus:!0})},onBlur:function onBlur(){var e=this,t=setTimeout(function(){e.setState({hasFocus:!1})},3e3);this.setState({blurTimeout:t})},onCloseSession:function onCloseSession(e){if(!this.state.busy){var t=-1;for(t=0;t<this.state.sessions.length&&this.state.sessions[t].id!==e;t+=1);if(-1!==t){var s=this.state.sessions[t];s&&(s.stream.end(),this.setState({sessions:this.state.sessions.slice(0,t).concat(this.state.sessions.slice(t+1))}),this.setState({currentSession:Math.max(0,Math.min(this.state.sessions.length-1,this.state.currentSession))}))}}},onCloseAllSessions:function onCloseAllSessions(){var e=this;this.stopAllSessions().then(function(){return e._resetState()})},stopAllSessions:function stopAllSessions(){var e=this;return new Promise(function(t){e.state.sessions.forEach(function(t){e.onCloseSession(t.id)}),t()})},onSelectSession:function onSelectSession(e){this.setState({currentSession:e})},onSetFontSize:function onSetFontSize(e){this.setState({fontSize:e})},currentSession:function currentSession(){return this.state.sessions[this.state.currentSession]},canCreateSession:function canCreateSession(){return this.state.sessions.length<3}},p=a.a.createStore(h);t.a=p},nD6a:function(e,t,s){"use strict";var n=s("hhPA"),i=s.n(n),r=i.a.createActions([]);r.createSession=i.a.createAction({asyncResult:!0}),r.closeSession=i.a.createAction({asyncResult:!0}),r.closeAllSessions=i.a.createAction({asyncResult:!0}),r.selectSession=i.a.createAction(),r.setFontSize=i.a.createAction(),r.focus=i.a.createAction(),r.blur=i.a.createAction(),t.a=r},sEoa:function(e,t,s){"use strict";var n=s("sEfC"),i=s.n(n),r=s("Td3C"),a=s("YDNT"),o=s("Psin"),c=s("vH5F"),u=s("s12a"),l=s("4TZy"),h=s("H6Yg"),p=s("24Ii"),f=s.n(p),d=s("OAZI"),S=s("FdhO"),g=s("NjHJ");function _defineProperties(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}s.d(t,"b",function(){return k}),s.d(t,"a",function(){return C});var v=function containerProtocol(){return h.a.get("container_api_use_ssl")?"https":"http"},k=function proxyDomain(){return h.a.get("container_api_proxy_domain")},w=function handleError(e){e&&e.message&&d.a.error(e,e.extraInfo)},y=function handleConnectionError(e){var t=e.code,s=e.message;Object(c.a)("warn","Failed to connect to ContainerAPI [".concat(t,"]: ").concat(s)),o.a.increment("francine.godexer.connection_error",t)},m=function runErrorHandler(){return{}},b=function runHandler(e){var t=e.params;return t.stdout&&(t.stdout=decodeURIComponent(escape(atob(t.stdout)))),t.stderr&&(t.stderr=decodeURIComponent(escape(atob(t.stderr)))),t},F=function executeSpawn(e){return new Promise(function(t){var s="";e.on("data",function(e){s+=e}),e.on("end",function(e){return t({Content:s,Error:!e.status})})})},C=function(){function WorkshopWorkspaceInterface(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WorkshopWorkspaceInterface),this.slug=e.slug,this.type=e.einConfig.container_type,this.einConfig=e.einConfig,this.managementBaseUrl="".concat(window.location.protocol,"//").concat(window.location.host,"/api/management/v1"),this.workspace=Object(g.b)({Files:[{Path:this.slug,Name:this.slug,IsDir:!0,Files:[]}]})}return function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}(WorkshopWorkspaceInterface,[{key:"initialize",value:function initialize(){var e=this;return this.session&&(this.destroy(),delete this.session),this.debouncedGetFileCalls={},this.debouncedGetTree=i()(function(){r.a.getFileTree()},500),this.getWorkspace().then(function(t){e.closed||(e.mgmtWorkspace=t,e.session=new u.a({protocol:v(),apiBase:h.a.get("container_api_base"),userId:a.a.get("_id"),workspaceSlug:e.slug,einConfig:e.einConfig,encryptedKey:t.encrypted_key}),e.session.on("state",function(t){e.updateState(t)}),e.session.on("fsEvent",function(t){e.handleFsEvent(t)}),e.session.on("idle",function(){e.goIdle()}),e.session.on("error",w),e.session.on("connectionError",y),e.setupCodex(),e.session.initialize())}).catch(w),this.initializePromise=function createPromise(){var e,t;return{innerPromise:new Promise(function(s,n){e=s,t=n}),reject:t,resolve:e}}(),this.initializePromise.innerPromise}},{key:"setupCodex",value:function setupCodex(){var e=this;this.session.on("codex.stdin",function(){S.a.stdin()}),this.session.on("codex.stdout",function(e){S.a.stdout(e.message)}),this.session.on("codex.stderr",function(e){S.a.stderr("".concat(e.message,"\n"))}),S.a.input.listen(function(t){e.session.services.codex.input(t)})}},{key:"proxyUri",value:function proxyUri(e){return e.host("".concat(this.sessionID,".").concat(k())),e.port(""),e.protocol(v()),e}},{key:"workspaceInitialize",value:function workspaceInitialize(){var e=this;return this.session.services.config.syncConfig(),this.session.services.workspace.initialize(this.mgmtWorkspace).then(function(t){if(e.closed)throw new Error("Tried to start workspace handlers on an outdated connection");e.sessionID=t.session_id}).then(this.startServer.bind(this)).then(this.codexStart.bind(this)).then(this.getFileTree.bind(this)).then(function(){if(e.closed)throw new Error("Tried to set workspace readiness on an outdated connection");return r.a.setStatus(l.a.status("AVAILABLE")),r.a.setReadyState(!0),e.initializePromise&&(e.initializePromise.resolve(e.session),e.initializePromise=null),e.mgmtWorkspace}).catch(function(t){if(e.closed)throw new Error("Tried to set failure state on an outdated connection");throw e.initializePromise&&(e.initializePromise.reject(t),e.initializePromise=null),r.a.setStatus(l.a.status("UNAVAILABLE")),r.a.setReadyState(!1),t})}},{key:"runWithSession",value:function runWithSession(e){if(this.session)return e(this.session);if(this.initializePromise)return this.initializePromise.innerPromise.then(e);throw new Error("this.session does not exist.")}},{key:"goIdle",value:function goIdle(){r.a.setReadyState(!1),r.a.setIdleState(!0),r.a.saveFilesAndCheckWork().then(this.destroy.bind(this),this.destroy.bind(this))}},{key:"updateState",value:function updateState(e){if(!this.closed)switch(e){case"connecting":r.a.setStatus(l.a.status("CONNECTING"));break;case"connected":this.workspaceInitialize();break;case"disconnected":r.a.setStatus(l.a.status("DISCONNECTED")),r.a.setReadyState(!1);break;case"idle":r.a.setStatus(l.a.status("IDLE")),r.a.setReadyState(!1);break;case null:break;default:d.a.error("Unhandled godexClientState.status: ".concat(e))}}},{key:"getWorkspace",value:function getWorkspace(){var e=this;return new Promise(function(t,s){var n=f.a.post("".concat(e.managementBaseUrl,"/workspaces/user/").concat(a.a.id()));n.set("X-User-Id",a.a.id()),n.set("X-Auth-Token",a.a.authenticationToken()),n.send({workspace_slug:e.slug}),n.end(function(e,n){return e?s(e):t(n.body)})})}},{key:"restoreWorkspace",value:function restoreWorkspace(e){var t=this;return new Promise(function(s,n){var i=f.a.post("".concat(t.managementBaseUrl,"/workspaces/user/").concat(a.a.id(),"/restore"));i.set("X-User-Id",a.a.id()),i.set("X-Auth-Token",a.a.authenticationToken()),i.send({workspace_slug:t.slug,checkpoint_slug:e}),i.end(function(e,t){return e?n(e):s(t.body)})})}},{key:"persist",value:function persist(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.session.services.workspace.persist(e,t)}},{key:"getFileTree",value:function getFileTree(){var e=this;return this.runWithSession(function(t){return t.services.workspace.get().then(function(t){return t.Files=[t.Files],e.workspace=Object(g.b)(t),e.workspace})})}},{key:"getFiles",value:function getFiles(e){var t=this;return this.runWithSession(function(s){return s.services.workspace.getFiles(e).then(function(s){return s.files.forEach(function(e){t.workspace.updateFile(Object(g.a)(e))}),t.workspace.getFiles(e)})})}},{key:"getFile",value:function getFile(e){return this.getFiles([e]).then(function(e){return e[0]})}},{key:"deleteFile",value:function deleteFile(e){var t=this;return this.runWithSession(function(s){return s.services.workspace.deleteFile(e).then(function(){return t.workspace.deleteFile(e),e})})}},{key:"updateFiles",value:function updateFiles(e){var t=this,s=e.map(g.d);return this.runWithSession(function(n){return n.services.workspace.setFiles(s).then(function(){return t.workspace.updateFiles(e),e})})}},{key:"createDirectories",value:function createDirectories(e){var t=this,s=e.map(g.c);return this.runWithSession(function(n){return n.services.workspace.setFiles(s).then(function(){return t.workspace.createDirectories(e.map(function(e){return e.path})),e})})}},{key:"rename",value:function rename(e,t){var s=this;return this.runWithSession(function(n){return n.services.workspace.moveFile(e,t).then(function(){return s.workspace.rename(e,t),{prevPath:e,newPath:t,newFile:s.workspace.getFile(t)}})})}},{key:"restore",value:function restore(e){var t=this;return r.a.setReadyState(!1),this.restoreWorkspace(e).then(this.getWorkspace.bind(this)).then(function(e){return t.session.services.workspace.reset(e)}).then(this.stopServer.bind(this)).then(this.startServer.bind(this)).then(this.codexStop.bind(this)).then(this.codexStart.bind(this)).then(function(){return t.session.services.workspace.get()}).then(function(e){e.Files=[e.Files],t.workspace=Object(g.b)(e),r.a.setStatus(l.a.status("AVAILABLE")),r.a.setReadyState(!0)}).catch(function(){r.a.setStatus(l.a.status("UNAVAILABLE")),r.a.setReadyState(!1)})}},{key:"solution",value:function solution(e){return this.restore(e)}},{key:"spawn",value:function spawn(e,t){return this.session.services.shell.spawn(e,t)}},{key:"execute",value:function execute(e){var t=e.split(" "),s=t[0],n=t.slice(1);return this.session.services.shell.spawn(s,n).then(F)}},{key:"run",value:function run(e,t){return this.session.services.eval.run(e.path,t).then(b,m)}},{key:"codexStart",value:function codexStart(){return this.isWorkspaceCodex()?this.session.services.codex.start(this.einConfig.codex):Promise.resolve()}},{key:"codexStop",value:function codexStop(){return this.isWorkspaceCodex()?this.session.services.codex.stop():Promise.resolve()}},{key:"codexRun",value:function codexRun(e){return this.session.services.codex.run(e)}},{key:"codexSct",value:function codexSct(e){return this.session.services.codex.sct(e)}},{key:"startServer",value:function startServer(){var e=this;return this.runWithSession(function(t){if(e.einConfig.server)return e.session.services.server.start(e.einConfig.server)})}},{key:"stopServer",value:function stopServer(){return this.session.services.server.stop()}},{key:"handleFsEvent",value:function handleFsEvent(e){this.workspace.getFile(e.path)&&(void 0===this.debouncedGetFileCalls[e.path]&&(this.debouncedGetFileCalls[e.path]=i()(function(){r.a.getFile(e.path)},500)),this.debouncedGetFileCalls[e.path]()),this.debouncedGetTree()}},{key:"isWorkspaceCodex",value:function isWorkspaceCodex(){return!!this.einConfig.codex}},{key:"ping",value:function ping(){this.runWithSession(function(e){e.services.server.status("http")})}},{key:"destroy",value:function destroy(){var e=this;if(this.closed=!0,this.session){["fsEvents","state","idle"].forEach(function(t){e.session.removeAllListeners(t)});try{this.session.terminate()}catch(e){d.a.error(e)}}}}]),WorkshopWorkspaceInterface}()}}]);
//# sourceMappingURL=2.c1484c4cb40ed06570b7.chunk.js.map